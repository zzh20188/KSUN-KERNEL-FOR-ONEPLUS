name: æµ‹è¯•
run-name: ${{ github.actor }} æ­£åœ¨æµ‹è¯• GitHub Actions ğŸš€
permissions:
  contents: write  # Allow writing to repository contents (for pushing tags)
  actions: write   # Allows triggering actions
on:
  workflow_dispatch:
 
jobs:
  test_job:
    runs-on: ubuntu-22.04
    env:
      CCACHE_COMPILERCHECK: "%compiler% -dumpmachine; %compiler% -dumpversion"
      CCACHE_NOHASHDIR: "true"
      CCACHE_HARDLINK: "true"
      CI: "false"
    #   MODEL: ${{ inputs.phone == 'å°ç±³10' && 'Mi10' || 'MI10PRO' }} 
    steps:
      - run: echo "ğŸ‰ è¯¥ä»»åŠ¡è‡ªåŠ¨è§¦å‘äº ${{ github.event_name }} äº‹ä»¶."
      - run: echo "${{ inputs.m }}-${{ inputs.gki }}-${{ inputs.model }}"

      - name: åˆ›å»ºå‡ ä¸ªæ–‡ä»¶ç”¨äºæµ‹è¯•
        run: |
          mkdir -p work/out/dist
          cd work/out/dist
          # åˆ›å»º boot.img æ–‡ä»¶ï¼Œå¤§å°ä¸º 514KB
          dd if=/dev/zero of=boot.img bs=1K count=514
          # åˆ›å»º boot-gz.img æ–‡ä»¶ï¼Œå¤§å°ä¸º 514KB
          dd if=/dev/zero of=boot-gz.img bs=1K count=514
          # åˆ›å»º boot-lz4.img æ–‡ä»¶ï¼Œå¤§å°ä¸º 514KB
          dd if=/dev/zero of=boot-lz4.img bs=1K count=514
          # åˆ›å»º Image æ–‡ä»¶ï¼Œå¤§å°ä¸º 514KB
          dd if=/dev/zero of=Image bs=1K count=514
          # åˆ›å»º Image.gz æ–‡ä»¶ï¼Œå¤§å°ä¸º 514KB
          dd if=/dev/zero of=Image.gz bs=1K count=514
          # åˆ›å»º Image.lz4 æ–‡ä»¶ï¼Œå¤§å°ä¸º 514KB
          dd if=/dev/zero of=Image.lz4 bs=1K count=514
      - name: æ‰«æç›®å½•
        run: |
          git clone https://github.com/zzh20188/KSUN-KERNEL-FOR-ONEPLUS --depth=1 local
          git clone https://github.com/Kernel-SU/AnyKernel3 --depth=1 ak3
          ls local/
          ls local/patches/
          ls

      - name: æ•´åˆèµ„æº
        run: |
          #æ­£å¸¸Image
          mkdir -p src
          cp work/out/dist/Image ak3/
          zip -r "${{ inputs.m }}.zip"  ak3/*
          rm ak3/Image
          #gzipå‹ç¼©ç‰ˆ
          cp work/out/dist/Image.gz ak3/
          zip -r "${{ inputs.m }}-gz.zip"  ak3/*
          rm ak3/Image.gz
          #lz4å‹ç¼©ç‰ˆ
          cp work/out/dist/Image.lz4 ak3/
          zip -r "${{ inputs.m }}-lz4.zip"  ak3/*
          rm ak3/Image.lz4
          #æ­£å¸¸boot
          cp work/out/dist/boot.img src/
          cp work/out/dist/boot-gz.img src/
          cp work/out/dist/boot-lz4.img src/
  
      - name: ä¸Šä¼ é•œåƒï¼ˆImageéœ€è¦æ‰‹åŠ¨æ›¿æ¢åˆ°åˆ·å…¥åŒ…ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: Image
          path: |
            src/*
